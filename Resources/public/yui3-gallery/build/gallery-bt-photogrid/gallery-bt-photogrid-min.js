YUI.add("gallery-bt-photogrid",function(b){var c="widthChange",i="columnWidthChange",a="renderFinished",j=100,f="bpg_",h={COLUMN:f+"column",MODULE:f+"module"},g={COLUMN:'<div class="'+h.COLUMN+'"></div>'},e={vertical:1,horizontal:1},d=b.Base.create("btphotogrid",b.Widget,[b.Bottle.SyncScroll],{initializer:function(){this.parseImageData();this.set("syncScrollMethod",this._updateColumns);this.publish(a);this._bpgEventHandlers=this.after(i,this._updateColumns);},destructor:function(){this._bpgEventHandlers.detach();delete this._bpgEventHandlers;},renderUI:function(){this._updateColumns(true);},append:function(k){var l=b.Node.create(k);this.parseImageData((l.getDOMNode().nodeType==11)?b.Node.create("<div>"+k+"</div>"):l,true);this.renderImages(true);},parseImageData:function(o,l){var k=l?this._bpgImages:[],n=this,m=this.get("photoNode"),p=o||this.get("contentBox");if(!l){this._bpgPending=0;}p.all(this.get("moduleNode")).each(function(s){var r={icon:s.getData("icon"),img:s.getData("img"),width:s.getData("width"),height:s.getData("height"),module:s.addClass(h.MODULE),error:false},q=s.one(m);if(!r.icon){return;}r.load=b.Node.create('<img src="'+r.icon+'" />');if(q){q.append(r.load);}else{s.insert(r.load,0);}if(!r.height||!r.width){this._bpgPending+=1;r.load.once("load",function(t){var u=t.target;this.height=u.get("height");this.width=u.get("width");n._bpgPending-=1;},r);r.load.once("error",function(t){this.error=true;n._bpgPending-=1;},r);}k.push(r);},this);this._bpgImages=k;},_minColumn:function(){var k=9999,l;this.get("contentBox").all("> div").each(function(n){var m=n.get("offsetHeight");if(m<k){k=m;l=n;}});return l;},renderImages:function(m){var k,l=j;if(m&&this._bpgRendering){return;}this._bpgRendering=true;if(this._bpgImages.length<=this._bpgRendered){this._bpgRendering=false;this.syncScroll();this.fire(a);return;}k=this._bpgImages[this._bpgRendered];if(k.width||k.error){if(k.error){k.load.setAttribute("src",this.get("errorImage"));}this._minColumn().append(k.module);this._bpgRendered+=1;l=1;}b.later(l,this,this.renderImages);},_updateColumns:function(q){var n=this.get("contentBox"),l=n.get("offsetWidth"),t=this.get("columnWidth"),p=Math.round(l/t),r=Math.floor(l/p),o=l-r*(p-1),m=g.COLUMN,k=q||(this._bpgColumns!==p),s;if(k){n.all(this.get("moduleNode")).remove();n.set("innerHTML","");this._bpgColumns=p;for(s=0;s<p;s++){n.append(m);}}n.all("> div").each(function(v,u){v.set("offsetWidth",u?r:o);});this.syncScroll();if(k){this._bpgRendered=0;this.renderImages(true);}}},{ATTRS:{errorImage:{value:"http://l.yimg.com/f/i/tw/map/i/cpx.gif",validator:b.Lang.isString},columnWidth:{value:200,validator:function(k){return(k*1>0);},setter:function(k){return k*1;}},gridType:{value:"vertical",validator:function(k){return e[k]?true:false;}},moduleNode:{value:"> div",validator:b.Lang.isString},photoNode:{value:".img",validator:b.Lang.isString}},HTML_PARSER:{errorImage:function(k){return k.getData("error-image");},columnWidth:function(k){return k.getData("column-width");},gridType:function(k){return k.getData("grid-type");},moduleNode:function(k){return k.getData("module-node");},photoNode:function(k){return k.getData("photo-node");}}});b.namespace("Bottle").PhotoGrid=d;},"@VERSION@",{requires:["gallery-bt-syncscroll"]});